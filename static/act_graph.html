<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="http://neo4j-contrib.github.io/developer-resources/language-guides/assets/css/main.css">
    <title>Neo4j Movies</title>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" type="text/javascript"></script>
</head>

<body>
	<div role="navigation" class="navbar navbar-default navbar-static-top">
	    <div class="container">
	        <div class="row">
	            <div class="col-sm-2 col-md-6">
	                <ul class="nav navbar-nav">
	                    <li>
	                         <form class="navbar-form">
	                            <a class="btn btn-default" href="/"> Home</a>
	                        </form>
	                    </li>
	                </ul>
	            </div>
	            <div class="col-sm-6 col-md-6">
	                <ul class="nav navbar-nav">
	                    <li>
	                        <form role="search" class="navbar-form" id="search">
	                            <div class="form-group">
	                                <input type="text" value="Matrix" placeholder="Search for Movie Title" class="form-control" name="search">
	                            </div>
	                            <button class="btn btn-default" type="submit">Search</button>
	                        </form>
	                    </li>
	                </ul>
	            </div>
	            <div class="col-sm-2 col-md-6">
	                <ul class="nav navbar-nav">
	                    <li>
	                         <form class="navbar-form">
	                            <a class="btn btn-default" href="/act_graph"> Actors</a>
	                        </form>
	                    </li>
	                </ul>
	            </div>
	            <div class="col-sm-2 col-md-6">
	                <ul class="nav navbar-nav">
	                    <li>
	                         <form class="navbar-form">
	                            <a class="btn btn-default" href="/dir_graph"> Directors</a>
	                        </form>
	                </li>   
	                </ul>
	            </div>
	        </div>
	    </div>
	</div>
	<div id="graph">
	</div>
	<style type="text/css">
		.node { stroke: #222; stroke-width: 1.5px;}
		.node.actor { fill: #0f0;}
		.node.movie { fill: #ff0; }
		#graph {overflow: hidden;}
		.link { stroke: #999; stroke-opacity: .6; stroke-width: 3px; }
	</style>
	<script type="text/javascript">
		let change_size=2000;
		let vbox_x = -300;
		let vbox_y = -300;
		$(document).ready(function(){
		    $('svg').bind('mousewheel', function(e){
		        if(e.originalEvent.wheelDelta /120 > 0) {
		            console.log('scrolling up !');
		            change_size-=100;
		        }
		        else{
		            console.log('scrolling down !');
		            change_size+=100;
		        }
		        $('svg').attr('viewBox',`${vbox_x} ${vbox_y} ${change_size} ${change_size}`)
		    });
		    $('svg').bind('mousedown', function(e){
		    	console.log('ke!');
		        document.onmousemove = function(k){
		        	vbox_x+=(k.pageX-e.pageX)/100;
		        	vbox_y+=(k.pageY-e.pageY)/100;
		        	console.log(vbox_x,vbox_y)
		        	$('svg').attr('viewBox',`${vbox_x} ${vbox_y} ${change_size} ${change_size}`)
		        }
		    });
		    $('svg').bind('mouseup', function(e){
		    	console.log('wke!');
		        document.onmousemove = null
		    });
		});
		var width = 800, height = 800;

		var force = d3.layout.force()
				.charge(-200).linkDistance(30).size([width, height]);

		var svg = d3.select("#graph").append("svg")
			.attr('viewBox',`${vbox_x} ${vbox_y} 2000 2000`)
			.attr("pointer-events", "all");

		d3.json("/graph", function(error, graph) {
			if (error) return;

			force.nodes(graph.nodes).links(graph.links).start();

			var link = svg.selectAll(".link")
					.data(graph.links).enter()
					.append("line").attr("class", "link");

			var node = svg.selectAll(".node")
					.data(graph.nodes).enter()
					.append("a")
					.attr("href", function (data) { return data.wiki })
					.attr("target","_blank")
					.append("circle")
					.attr("class", function (d) { return "node "+d.label })
					.attr("r", 10)
					
					.call(force.drag);

			// html title attribute
			node.append("title")
					.text(function (d) { return d.title; })

			// force feed algo ticks
			force.on("tick", function() {
				link.attr("x1", function(d) { return d.source.x; })
						.attr("y1", function(d) { return d.source.y; })
						.attr("x2", function(d) { return d.target.x; })
						.attr("y2", function(d) { return d.target.y; });

				node.attr("cx", function(d) { return d.x; })
						.attr("cy", function(d) { return d.y; });
			});
		});
	</script>
</body>
</html>